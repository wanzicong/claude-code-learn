---
description: 以代码库理解和架构为重点的引导式功能开发
argument-hint: 可选的功能描述
---

# 功能开发

您正在帮助开发人员实现一个新功能。遵循系统化的方法：深入理解代码库，识别并询问所有未充分指定的细节，设计优雅的架构，然后实施。

## 核心原则

- **提出澄清问题**：识别所有歧义、边缘情况和未充分指定的行为。提出具体、具体的问题，而不是做出假设。在继续实施之前等待用户回答。尽早提出问题（在理解代码库之后、在设计架构之前）。
- **先理解后行动**：首先阅读并理解现有的代码模式
- **阅读代理识别的文件**：启动代理时，要求它们返回最重要的文件列表。代理完成后，阅读这些文件以在继续之前建立详细的上下文。
- **简单优雅**：优先考虑可读、可维护、架构健全的代码
- **使用 TodoWrite**：跟踪所有进度

---

## 阶段 1：发现

**目标**：了解需要构建什么

初始请求：$ARGUMENTS

**操作**：
1. 创建包含所有阶段的待办事项列表
2. 如果功能不明确，询问用户：
   - 他们正在解决什么问题？
   - 功能应该做什么？
   - 有任何约束或要求吗？
3. 总结理解并与用户确认

---

## 阶段 2：代码库探索

**目标**：在高层和低层层面上理解相关的现有代码和模式

**操作**：
1. 并行启动 2-3 个 code-explorer 代理。每个代理应该：
   - 全面跟踪代码，专注于全面理解抽象、架构和控制流
   - 针对代码库的不同方面（例如类似功能、高层理解、架构理解、用户体验等）
   - 包括 5-10 个要阅读的关键文件列表

   **示例代理提示**：
   - "查找与 [功能] 类似的功能并全面跟踪其实现"
   - "全面映射 [功能区域] 的架构和抽象，全面跟踪代码"
   - "全面分析 [现有功能/区域] 的当前实现，全面跟踪代码"
   - "识别与 [功能] 相关的 UI 模式、测试方法或扩展点"

2. 代理返回后，请阅读代理识别的所有文件以建立深入的理解
3. 呈现发现和模式的全面摘要

---

## 阶段 3：澄清问题

**目标**：在设计之前填补空白并解决所有歧义

**关键**：这是最重要的阶段之一。不要跳过。

**操作**：
1. 审查代码库发现和原始功能请求
2. 识别未充分指定的方面：边缘情况、错误处理、集成点、范围边界、设计偏好、向后兼容性、性能需求
3. **以清晰、有组织的列表向用户呈现所有问题**
4. **在继续架构设计之前等待答案**

如果用户说"您认为最好的任何内容"，请提供您的建议并获得明确确认。

---

## 阶段 4：架构设计

**目标**：设计具有不同权衡的多种实施方法

**操作**：
1. 并行启动 2-3 个 code-architect 代理，具有不同的重点：最小更改（最小更改，最大重用）、清洁架构（可维护性、优雅的抽象）或务实平衡（速度 + 质量）
2. 审查所有方法并形成您对哪种方法最适合此特定任务的意见（考虑：小修复与大功能、紧迫性、复杂性、团队上下文）
3. 向用户呈现：每种方法的简要摘要、权衡比较、**您的建议及理由**、具体实施差异
4. **询问用户他们更喜欢哪种方法**

---

## 阶段 5：实施

**目标**：构建功能

**未经用户批准不要开始**

**操作**：
1. 等待明确的用户批准
2. 阅读在前几个阶段中识别的所有相关文件
3. 按照选择的架构实施
4. 严格遵循代码库约定
5. 编写清晰、文档完善的代码
6. 随着进度更新待办事项

---

## 阶段 6：质量审查

**目标**：确保代码简单、DRY、优雅、易于阅读且功能正确

**操作**：
1. 并行启动 3 个 code-reviewer 代理，具有不同的重点：简单性/DRY/优雅、错误/功能正确性、项目约定/抽象
2. 整合发现并识别您建议修复的最高严重性问题
3. **向用户呈现发现并询问他们想要做什么**（现在修复、以后修复或按原样继续）
4. 根据用户决定解决问题

---

## 阶段 7：总结

**目标**：记录完成的内容

**操作**：
1. 将所有待办事项标记为完成
2. 总结：
   - 构建了什么
   - 做出的关键决策
   - 修改的文件
   - 建议的后续步骤

---
