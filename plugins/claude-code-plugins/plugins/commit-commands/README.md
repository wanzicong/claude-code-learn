# 提交命令插件

使用简单的命令来提交、推送和创建拉取请求，简化您的 git 工作流。

## 概述

提交命令插件自动化常见的 git 操作，减少上下文切换和手动命令执行。无需运行多个 git 命令，只需使用单个斜杠命令即可处理整个工作流。

## 命令

### `/commit`

创建一个基于暂存和未暂存更改的自动生成提交消息的 git 提交。

**它的作用：**
1. 分析当前 git 状态
2. 审查暂存和未暂存的更改
3. 检查最近的提交消息以匹配您存储库的样式
4. 起草适当的提交消息
5. 暂存相关文件
6. 创建提交

**用法：**
```bash
/commit
```

**`示例工作流：**
```bash
# 对您的代码进行一些更改
# 然后简单地运行：
/commit

# Claude 将：
# - 审查您的更改
# - 暂存文件
# - 使用适当的消息创建提交
# - 显示提交状态
```

**功能：**
- 自动起草符合您存储库样式的提交消息
- 遵循传统提交惯例
- 避免提交包含机密（.env、credentials.json）的文件
- 在提交消息中包含 Claude Code 归属

### `/`commit-push-pr`

一步完成提交、推送和创建拉取请求的完整工作流命令。

**它的作用：**
1. 创建新分支（如果当前在 main 上）
2. 使用适当的消息暂存和提交更改
3. 将分支推送到 origin
4. 使用 `gh pr create` 创建拉取请求
5. 提供 PR URL

**用法：**
```bash
/commit-push-pr
```

**示例工作流：**
```bash
# 进行您的更改
# 然后运行：
/commit-push-pr

# Claude 将：
# - 创建功能分支（如果需要）
# - 提交您的更改
# - 推送到远程
# - 使用摘要和测试计划打开 PR
# - 给您 PR URL 以供审查
```

**功能：**
- 分析分支中的所有提交（不仅仅是最近的）
- 创建全面的 PR 描述，包括：
  - 更改摘要（1-3 个要点）
  - 测试计划检查表
  - Claude Code 归属
- 自动处理分支创建
- 使用 GitHub CLI (`gh`) 进行 PR 创建

**要求：**
- 必须已安装并经过身份验证 GitHub CLI (`gh`)
- 存储库必须具有名为 `origin` 的远程

### `/clean_gone`

清理已从远程存储库删除的本地分支。

**它的作用：**
1. 列出所有本地分支以识别 [gone] 状态
2. 识别并删除与 [gone] 分支关联的 worktrees
3. 删除所有标记为 [gone] 的分支
4. 提供有关已删除分支的反馈

**用法：**
```bash
/clean_gone
```

**示例工作流：**
```bash
# 在 PR 合并并删除远程分支后
/clean_gone

# Claude 将：
# - 查找所有标记为 [gone] 的分支
# - 删除任何关联的 worktrees
# - 删除过时的本地分支
# - 报告清理的内容
```

**功能：**
- 处理常规分支和 worktree 分支
- 在删除分支之前安全地删除 worktrees
- 显示有关已删除内容的清晰反馈
- 如果不需要清理则报告

**何时使用：**
- 合并和删除远程分支后
- 当本地分支列表被过时的分支弄乱时
- 在定期存储库维护期间

## 安装

此插件包含在 Claude Code 存储库中。使用 Claude Code 时，命令自动可用。

## 最佳实践

### 使用 `/commit`
- 提交之前审查暂存的更改
- 让 Claude 分析您的更改并匹配您存储库的提交样式
- 信任自动消息，但验证其准确性
- 在开发期间用于常规提交

### 使用 `/commit-push-pr`
- 准备创建 PR 时使用
- 确保所有更改都已完成并经过测试
- Claude 将分析完整的分支历史以获取 PR 描述
- 审查 PR 描述并在需要时进行编辑
- 当您想要最小化上下文切换时使用

### 使用 `/clean_gone`
- 定期运行以保持分支列表整洁
- 在合并多个 PR 后特别有用
- 可以安全运行 - 仅删除已在远程删除的分支
- 有助于维护整洁的本地存储库

## 工作流集成

### 快速提交工作流：
```bash
# 编写代码
/commit
# 继续开发
```

### 功能分支工作流：
```bash
# 跨多个提交开发功能
/commit  # 第一次提交
# 更多更改
/commit  # 第二次提交
# 准备创建 PR
/commit-push-pr
```

### 维护工作流：
```bash
# 在几个 PR 合并后
/clean_gone
# 清理工作区，准备下一个功能
```

## 要求

- 必须已安装并配置 Git
- 对于 `/commit-push-pr`：必须已安装并经过身份验证 GitHub CLI (`gh`)
- 存储库必须是具有远程的 git 存储库

## 故障排除

### `/commit` 创建空提交

**问题**：没有可提交的更改
**解决方案**：
- 确保您有未暂存或暂存的更改
- 运行 `git status` 以验证更改存在

### `/commit-push-pr` 无法创建 PR

**问题**：`gh pr create` 命令失败
**解决方案**：
- 安装 GitHub CLI：`brew install gh` (macOS) 或参阅 [GitHub CLI 安装](https://cli.github.com/)
- 身份验证：`gh auth login`
- 确保存储库具有 GitHub 远程

### `/clean_gone` 未找到分支

**问题**：没有标记为 [gone] 的分支
**解决方案**：
- 运行 `git fetch --prune` 以更新远程跟踪
- 必须从远程删除分支才能显示为 [gone]

## 提示

- **与其他工具结合**：在开发期间使用 `/commit`，然后在准备好时使用 `/commit-push-pr`
- **让 Claude 起草消息**：提交消息分析从您存储库的样式中学习
- **定期清理**：每周运行 `/clean_gone` 以维护整洁的分支列表
- **推送前审查**：始终在推送之前审查提交消息和更改

## 作者

Anthropic (support@anthropic.com)

## 版本

1.0.0
